<!DOCTYPE html>

<html ng-app="httpApp" lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Decodeur - 1.0</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>

    <script src="bootstrap-3.3.6/dist/js/bootstrap.min.js"></script>
    <script src="bootstrap-3.3.6/dist/js/npm.js"></script>

    <link href="bootstrap-3.3.6/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="app.css" type="text/css"/>

    <script src="app.js"></script>
    <script src="Blockly/appengine/storage.js"></script>
    <script src="Blockly/blockly_uncompressed.js"></script>
    <!--<script src="Blockly/blocks_compressed.js"></script>-->

    <!--Blocks-->
    <script src="Blockly/blocks/colour.js"></script>
    <script src="Blockly/blocks/custom.js"></script>
    <script src="Blockly/blocks/custom_if.js"></script>
    <script src="Blockly/blocks/lists.js"></script>
    <script src="Blockly/blocks/logic.js"></script>
    <script src="Blockly/blocks/loops.js"></script>
    <script src="Blockly/blocks/math.js"></script>
    <script src="Blockly/blocks/procedures.js"></script>
    <script src="Blockly/blocks/text.js"></script>
    <script src="Blockly/blocks/variables.js"></script>

    <!-- To show xml with angular -->
    <!--<script src="Scripts/jquery-3.0.0.min.js"></script>-->
    <script src="Scripts/angular.min.js"></script>

    <!-- Overriden version of the core -->
    <script src="Blockly/core_override/procedures.js"></script>
    <script src="Blockly/core_override/variables.js"></script>

    <!-- Messages -->
    <script src="Blockly/msg/js/fr.js"></script>
    <script src="Dev/dev-mode.js"></script>

    <!--Csharp generator-->
    <script src="Blockly/generators/csharp.js"></script>
    <script src="Blockly/generators/csharp/variables.js"></script>
    <script src="Blockly/generators/csharp/lists.js"></script>
    <script src="Blockly/generators/csharp/colour.js"></script>
    <script src="Blockly/generators/csharp/logic.js"></script>
    <script src="Blockly/generators/csharp/math.js"></script>
    <script src="Blockly/generators/csharp/loops.js"></script>
    <script src="Blockly/generators/csharp/procedures.js"></script>
    <script src="Blockly/generators/csharp/text.js"></script>
    <script src="Blockly/generators/csharp/inferboilerplate.js"></script>
    <script src="Blockly/generators/csharp/inferbool_variables.js"></script>
    <script src="Blockly/generators/csharp/inferdistributions.js"></script>
    <script src="Blockly/generators/csharp/inferdouble_variables.js"></script>
    <script src="Blockly/generators/csharp/custom.js"></script>

    <script src="postCode.js"></script>
    <script src="Variables/values.js"></script>

    <!--AutoCompletion-->
    <script src="autocomplete_util.js"></script>
    <link rel="stylesheet" href="closure-library/closure/goog/css/autocomplete.css" type="text/css"/>
    <script>goog.require('goog.ui.ac');</script>

</head>

<body onkeydown="Squid.Dev.ToggleDevmode(event)">
    <div class="top-layer full-height">
        <div class="generated-code full-height" id="generated-code">
            <h1 class="no-margin"> Code généré </h1>
            <pre id="content1"></pre>
        </div>
        <aside class="side-bar full-height">
            <div class="row full-height">
                <aside class="code-hide full-height col-lg-2">
                    <button id="code-hide" onclick="hideGenerated()">
                        <div class="rotate"> Générer </div>
                    </button>
                </aside>
                <div class="col-lg-10">
                    <variables-set></variables-set>
                    <div id="Values">
                        <h1>Valeurs</h1>
                    </div>
                    <button class="item-workspace" onclick="Squid
    .displaySimpleVariables()">
                        Rafraîchir valeurs
                    </button>
                    <div id="decodingTest">
                        <h1>Tester le décodeur</h1>
                        <input id="valeur-a-decoder" type="text" value="valeur à décoder" />
                        <input id="nom-decodeur" type="text" value="nom du décodeur" />
                        <input id="resultat" type="text" class="textarea" value="resultat" />
                    </div>
                </div>
            </div>
        </aside>
    </div>
    <div class="row">
        <div class="col-md-9">
            <div id="wrapper">
                <toolbox></toolbox>
                <workspace></workspace>
            </div>
        </div>
    </div>

<!-- SCRIPTS -->

<script>
    /* Workspaces */
    var workspace;
    var hiddenWorkspace;

    /*AutoCompletion*/
    var acTags;

    /* Element IDs */
    var princToolboxId = "#toolboxGeneric";
    var BASE_BLOCKLY_DIV = "blocklyDiv";

    var app = angular.module("httpApp", []);
</script>

<script src="Workspace/workspace.viewmodel.js"></script>
<script src="Variables/variables_set.js"></script>
<script src="Variables/variables_set.wiewmodel.js"></script>


<script>
    function hideGenerated() {
        var gc = $("#generated-code");
        var fullSize = '75%';
        if (gc.css("width") === '0px') {
            generateCode();
            gc.css("width", fullSize);
            gc.css("opacity", 1);
        } else {
            gc.css("width", '0%');
            gc.css("opacity", 0);
        }
    }

    //------------------------------------------------------------------ Variables
    // Restore
    function launchDropdownRestoreSet(button, type) {

        button = $(button);
        button.html("");

        var locations;
        if (type == Squid.Variables.Types.CONFIG) {
            locations = Squid.Storage.ConfigLocations;
        } else if (type == Squid.Variables.Types.INVENTORY) {
            locations = Squid.Storage.InventoryLocations;
        } else {
            locations = [];
        }

        var ul = $("<ul>");
        ul.attr("class", "dropdown");
        ul.attr("role", "menu");
        ul.hover(null, function() { ul.remove(); });

        for (var i = 0; i < locations.length; i++) {
            var li = $("<li>");
            li.attr("role", "presentation");

            var but = $("<button>");
            but.attr("onclick", "restoreSet('" + locations[i] + "', '" + type + "');");
            but.html(locations[i]);

            li.append(but);
            ul.append(li);
        }
        button.append(ul);
    }

    function restoreSet(location, type) {
        if (location) {
            var workspace = Squid.Variables.getWorkspace(type);

            var names = Blockly.Variables.allVariables(workspace);

            Squid.Variables.deleteAll(type);
            Squid.Storage.RestoreVariables(
                type,
                location
            );

            var prefix = Squid.Variables.getPrefix(type);
            for (var i = 1; i < names.length; i++) {
                var l = prefix.length;
                var name = names[i].substr(l, names[i].length - l);
                Squid.Variables.create(type, name);
            }
            $(Squid.Variables.getAnchor(type) + "-title").text(location);
        } else {
            console.warn("Specify a location");
        }
    }

    //------------------------------------------------------------------ Tools
    /////**
    //// * Create a new workspace for editing a function.
    //// * @param {!Blockly.Workspace} workspace The workspace on which you want to add a function.
    //// */
    ////function createFunction(workspace) {
    ////    var funcWindow = document.getElementById("functionWrapper");
    ////    if (funcWindow.style.display === "none") {
    ////        funcWindow.style.display = "block";
    ////    }

    ////    // Hide the previous workspace
    ////    if (nbWorkspaces > 0) {
    ////        document.getElementById(BASE_BLOCKLY_DIV + valueActivWorkspace).style.display = "none";
    ////    }

    ////    // Create anchor
    ////    var newDiv = document.createElement('div');
    ////    newDiv.setAttribute("id", BASE_BLOCKLY_DIV + nbWorkspaces);
    ////    newDiv.setAttribute("class", BASE_BLOCKLY_DIV);
    ////    funcWindow.appendChild(newDiv);

    ////    // Create the workspace
    ////    var newWorkspace = Blockly.inject(BASE_BLOCKLY_DIV + nbWorkspaces,
    ////    { toolbox: document.getElementById('toolboxFunction') });
    ////    workspace.attachChildWorkspace(newWorkspace);
    ////    activWorkspace = newWorkspace;
    ////    valueActivWorkspace = nbWorkspaces;

    ////    // Create the onglet
    ////    var newOnglet = document.createElement('button');
    ////    newOnglet.setAttribute("class", "onglet");
    ////    newOnglet.setAttribute("name", "Nouveau");
    ////    newOnglet.setAttribute("id", "onglet" + nbWorkspaces);
    ////    newOnglet.setAttribute("value", nbWorkspaces);
    ////    newOnglet.setAttribute("checked", true);
    ////    newOnglet.setAttribute("onclick", "changeActiveWorkspace(" + nbWorkspaces + ")");
    ////    newOnglet.textContent = "Nouveau !";
    ////    document.getElementById("toolbar-onglet-func").appendChild(newOnglet);

    ////    nbWorkspaces++;
    ////}

    ////function changeActiveWorkspace(newValueActivWorkspace) {
    ////    document.getElementById(BASE_BLOCKLY_DIV + valueActivWorkspace).style.display = "none";
    ////    document.getElementById(BASE_BLOCKLY_DIV + newValueActivWorkspace).style.display = "block";
    ////    valueActivWorkspace = newValueActivWorkspace;
    ////}

    function generateCode() {
        var code = Blockly.CSharp.workspaceToCode(workspace);
        var div = $('#content1')[0];
        div.innerHTML = code;
    }

    function Refresh() {
        RefreshCategories(workspace, princToolboxId);
        //for autocompletion
        if (acTags) {
            acTags.matcher_ = new goog.ui.ac.ArrayMatcher(AutoComplete.GetTags(), true);
        }

    }

    function Save() {
        Squid.Storage.SaveFunction(workspace);
        Refresh();
    }

    function clearFunc(workspace) {
        var children = workspace.getLinkedWorkspace();
        for (var i = 0; i < children.length; i++) {
            children[i].clear();
            clearFunc(children[i]);
        }
    }

    function ClearFunction() {
        if (window
            .confirm("Êtes-vous sur de vouloir effacer toutes les fonctions ? A la prochaine sauvegarde, elle seront perdues.")) {
            clearFunc(workspace);
            Refresh();
        }
    }

</script>

<!-- Storage and parsing -->
<script src="Storage/storage.js"></script>
<script src="Storage/parsingXML.js"></script>
<script src="Toolbox/category.js"></script>

</body>
</html>